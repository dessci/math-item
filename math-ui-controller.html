<link rel="import" href="math-ui-dialog.html" />

<style>
    dialog.math-ui.page-menu {
        width: 15em;
    }
</style>

<template>
    <dialog class="math-ui page-menu">
        <div class="header">MathUI Dashboard</div>
        <div class="content">
            <button>Highlight All Equations</button>
            <button>Action 2</button>
            <button>Action 3</button>
            <button>Action 4</button>
        </div>
    </dialog>
</template>

<script>
(function () {
    'use strict';

    var importDoc = (document._currentScript ? document._currentScript : document.currentScript).ownerDocument;
    var mathUIDialog = document.createElement('math-ui-dialog');
    var elements = [];
    var element = Object.create(HTMLElement.prototype);

    function async(fn) {
        requestAnimationFrame(fn);
    }

    element.addItem = function (item) {
        elements.push(item);
        return '' + elements.length;
    };

    element.toggleHighlightAll = function () {
        elements.forEach(function (el) {
            el.classList.toggle('highlight');
        });
    };

    element.showMenu = function () {
        var tmpl = importDoc.querySelector('template');
        var node = document.importNode(tmpl.content, true);
        var buttons = node.querySelectorAll('button');
        var dialog = node.querySelector('dialog');
        var self = this;
        mathUIDialog.showModal(dialog, function (ev) {
            var action;
            if (ev.target === buttons[0])
                action = element.toggleHighlightAll.bind(self);
            if (action) {
                async(action);
                return true;
            }
            return ev.target === dialog;
        });
    };

    document.registerElement('math-ui-controller', {prototype: element});

})();
</script>

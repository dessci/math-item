var MathUI;!function(a){"use strict";function b(a){var b=typeof a;return"function"===b||"object"===b&&!!a}function c(a,b){return null!=a&&n.call(a,b)}function d(a){if(!b(a))return[];if(o)return o(a);var d=[];for(var e in a)c(a,e)&&d.push(e);return d}function e(a,b,c){if(null==a)return a;var e,f=a.length;if(f===+f)for(e=0;f>e;e++)b.call(c,a[e],e,a);else{var g=d(a);for(e=0,f=g.length;f>e;e++)b.call(c,a[g[e]],g[e],a)}return a}function f(a,b,c){if(null==a)return[];for(var e,f=a.length!==+a.length&&d(a),g=(f||a).length,h=Array(g),i=0;g>i;i++)e=f?f[i]:i,h[i]=b.call(c,a[e],e,a);return h}function g(a,b,c){var d=[];return e(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d}function h(a,b){return k(a,b)>=0}function i(a,b){return g(a,function(a){return!h(b,a)})}function j(a,b){var c=i(a,b);return Array.prototype.push.apply(c,b),c}function k(a,b){for(var c=0;c<a.length;c++)if(b===a[c])return c;return-1}function l(){return q}function m(){var a,b=new r(function(b){a=b});return b.resolve=a,b}var n=Object.prototype.hasOwnProperty,o=Object.keys,p=String.prototype.trim?function(a){return a.trim()}:function(){var a="[\\s\\uFEFF\\xA0]",b=new RegExp("^"+a+"+|"+a+"+$","g");return function(a){return a.replace(b,"")}}(),q={each:e,map:f,filter:g,indexOf:k,contains:h,union:j,difference:i,without:function(a,b){return g(a,function(a){return a!==b})},trim:p,words:function(a){return a=p(a),a?a.split(/\s+/):[]},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},toArray:function(a){return f(a,function(a){return a})}};a.getUtils=l;var r=function(){function a(a){var b=this;this._thens=[];var c=function(){e(b._thens,function(a){b.then(a.resolved,a.rejected)}),delete b._thens};a(function(a){b.then=function(b){b(a)},c()},function(a){b.then=function(b,c){c&&c(a)},c()})}return a.prototype.then=function(a,b){this._thens.push({resolved:a,rejected:b})},a.resolve=function(b){return new a(function(a){a(b)})},a.all=function(b){return new a(function(a,c){function d(f){f<b.length?b[f].then(function(a){e.push(a),d(f+1)},function(a){c(a)}):a(e)}var e=[];d(0)})},a}();a.Promise=r,a.makePromiseWithResolver=m,a.async="function"==typeof requestAnimationFrame?function(a){requestAnimationFrame(a)}:function(a){setTimeout(a,0)}}(MathUI||(MathUI={}));var MathUI;!function(a){"use strict";a.microJQ=function(b,c,d){function e(){return""+ ++s}function f(a){var b=a.microjqid,c=b&&r[b];return c||(a.microjqid=b=e(),r[b]=c={events:{},handler:d}),c}function g(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function h(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)}function i(a,b){function c(c){var d=b[c.type];if(d&&d.length){var e=new w(c);d.length>1&&(d=q.toArray(d)),q.each(d,function(b){b.call(a,e)})}}return c}function j(a,b,c){var d=f(a),e=d.events,g=d.handler;if(g)if(b)q.each(q.words(b),function(b){if(c){var d=e[b];if(d&&(d=q.without(d,c),d.length))return}h(a,b,g),delete e[b]});else for(b in e)h(a,b,g),delete e[b]}function k(a){var b=a.microjqid,c=b&&r[b];c&&(c.handler&&j(a),delete r[b],a.microjqid=d)}function l(a){k(a),q.each(a.querySelectorAll("*"),function(a){k(a)})}function m(a){var b=this;this.length=0,q.each(a,function(a){b[b.length++]=a})}function n(a,b){a.textContent!==d?a.textContent=b:a.innerText=b}function o(a){return a.textContent!==d?a.textContent:a.text!==d?a.text:a.innerText}function p(a,b){var c=[];return q.each(a,function(a){for(var d=a.firstChild;null!=d;)(!b||b(d))&&c.push(d),d=d.nextSibling}),c}var q=a.getUtils(),r={},s=0,t=["keydown","keyup","keypress"],u=["mousedown","mouseup","click"],v=[1,1,3,0,2],w=function(){function a(a){this.originalEvent=a,this.type=a.type,this.target=a.target||a.srcElement,this.which=0,q.contains(t,a.type)?this.which=a.which||a.keyCode:q.contains(u,a.type)&&(this.which=a.which!==d?a.which:v[a.button])}return a.prototype.preventDefault=Event.prototype.preventDefault?function(){this.originalEvent.preventDefault()}:function(){this.originalEvent.returnValue=!1},a.prototype.stopPropagation=Event.prototype.stopPropagation?function(){this.originalEvent.stopPropagation()}:function(){this.originalEvent.cancelBubble=!0},a}(),x=function(){function a(a){return a.cloneNode(!0)}function b(a){var c=a.cloneNode(!1);if(1===c.nodeType&&"script"===a.nodeName.toLowerCase())c.text=a.text;else for(var d=a.firstChild;null!==d;d=d.nextSibling)c.appendChild(b(d));return c}var d=c.createElement("script");return d.text="x","x"===d.cloneNode(!0).text?a:b}();m.prototype={find:function(a){var b=[];return q.each(this,function(c){q.each(c.querySelectorAll(a),function(a){b.push(a)})}),new m(b)},contents:function(){return new m(p(this))},children:function(){return new m(p(this,function(a){return 1===a.nodeType}))},clone:function(){return new m(q.map(this,x))},first:function(){return 0===this.length?this:new m([this[0]])},data:function(a){return this[0].getAttribute("data-"+a)},width:function(){var a=this[0].getBoundingClientRect();return a.width!==d?a.width:a.right-a.left},height:function(){var a=this[0].getBoundingClientRect();return a.height!==d?a.height:a.bottom-a.top},each:function(a){return q.each(this,function(b,c){a.call(b,c,b)})},text:function(a){return a!==d?q.each(this,function(b){n(b,a)}):q.map(this,o).join("")},append:function(){for(var a=this,b=[],d=0;d<arguments.length;d++)b[d-0]=arguments[d];var e=[];return q.each(b,function(a){q.each(q.isArray(a)?a:[a],function(a){a instanceof m?Array.prototype.push.apply(e,q.toArray(a)):e.push("string"==typeof a?c.createTextNode(a):a)})}),q.each(this,function(b,c){var d=c<a.length-1;q.each(e,function(a){b.appendChild(d?a.cloneNode(!0):a)})}),this},toArray:function(){return q.toArray(this)}},q.map({blur:function(a){a.blur()},focus:function(a){a.focus()},css:function(a,b,c){a.style[b]=c},remove:function(a){l(a);var b=a.parentNode;b&&b.removeChild(a)},addClass:function(a,b){a.className=q.union(q.words(a.className),q.words(b)).join(" ")},removeClass:function(a,b){a.className=b?q.difference(q.words(a.className),q.words(b)).join(" "):""},attr:function(a,b,c){a.setAttribute(b,c)},removeAttr:function(a,b){a.removeAttribute(b)},on:function(a,b,c){var d=f(a),e=d.events,h=d.handler;h||(h=d.handler=i(a,e)),q.each(q.words(b),function(b){var d=e[b];d||(d=e[b]=[],g(a,b,h)),d.push(c)})},off:j},function(a,b){m.prototype[b]=function(b,c){return q.each(this,function(d){a(d,b,c)})}});var y=function(a){return new m(q.isArray(a)?a:[a])};return y.ready=function(){var d="complete"===c.readyState?a.Promise.resolve():new a.Promise(function(a){function d(){e||(e=!0,a())}var e=!1;c.addEventListener&&c.addEventListener("DOMContentLoaded",d),c.attachEvent&&c.attachEvent("onreadystatechange",function(){"complete"===c.readyState&&d()}),g(b,"load",d)});return function(){return d}}(),y.parseXML="function"==typeof DOMParser?function(a){return(new DOMParser).parseFromString(a,"text/xml")}:"function"==typeof ActiveXObject&&new ActiveXObject("Microsoft.XMLDOM")?function(a){var b=new ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b}:function(){throw new Error("parseXML not supported")},y}(window,document)}(MathUI||(MathUI={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},MathUI;!function(a){"use strict";function b(){return l}function c(a){return document.createElement(a)}function d(a){a.stopPropagation(),a.preventDefault()}function e(a){var b=a.type;return a.subtype&&(b+=" ("+a.subtype+")"),b}function f(){r=!r,m.each(q,function(a){a.changeHighlight(r)})}function g(){window.location.href="https://github.com/dessci/math-ui"}function h(){var a=new w;a.show()}function i(a,b){return p.put(a,b)}function j(){return x}function k(){return y}var l=a.microJQ,m=a.getUtils();a.get$=b;var n=function(){function b(){}return b.prototype.canHandle=function(){return!1},b.prototype.init=function(){return null},b.prototype.clonePresentation=function(a,b){l(b).append(l(a).contents().clone())},b.prototype.getSources=function(){return a.Promise.resolve([])},b}();a.Handler=n;var o=function(){function a(){this.handlerDict={},this.handlerOrder=[]}return a.prototype.put=function(a,b){var c=this.remove(a);return this.handlerDict[a]=b,this.handlerOrder.splice(0,0,a),c},a.prototype.get=function(a){return this.handlerDict[a]},a.prototype.remove=function(a){if(a in this.handlerDict){var b=m.indexOf(this.handlerOrder,a);b>=0&&this.handlerOrder.splice(b,1),delete this.handlerDict[a]}return null},a.prototype.find=function(a){for(var b=0;b<this.handlerOrder.length;b++){var c=this.handlerDict[this.handlerOrder[b]];if(a(c))return c}},a}(),p=new o,q={},r=!1,s=function(){function b(){}return b.prototype.show=function(a,b,e,f){var g=this;if(f=f||document.body,this.wrapper=l(c("div")).addClass("math-ui-wrapper"),this.dialog=l(c("div")).addClass(a).append(this.wrapper),this.element=f===document.body?l(c("div")).addClass("math-ui-backdrop").append(this.dialog):this.dialog,b(this.wrapper),e){var h=l(c("div")).addClass("math-ui-footer");m.each(e,function(a){var b=l(c("button")).append(a.label).on("click",function(){a.action()});h.append(b)}),this.wrapper.append(h)}this.documentHandler=function(a){("click"===a.type?1===a.which:27===a.which)?(d(a),g.close()):"keydown"===a.type&&g.keydown(a)},l(f).append(this.element),l(document).on("click keydown",this.documentHandler),this.dialog.on("click",function(a){1===a.which&&(d(a),g.click(a))})},b.prototype.close=function(){l(document).off("click keydown",this.documentHandler),this.element.remove(),this.element=this.documentHandler=void 0},b.prototype.fitContentHeight=function(){var b=this,c=this.wrapper.height();this.dialog.css("height",c+"px"),0>=c&&a.async(function(){b.dialog.css("height",b.wrapper.height()+"px")})},b.prototype.click=function(){},b.prototype.keydown=function(){},b}(),t=function(a){function b(b){a.call(this),this.host=b}return __extends(b,a),b.prototype.show=function(){var b=this;a.prototype.show.call(this,"math-ui-zoom",function(a){b.host.clonePresentation(a)},void 0,this.host.element)},b.prototype.click=function(){this.close()},b}(s),u=function(a){function b(b){var c=this;a.call(this),this.host=b,this.host.getSources().then(function(a){c.sources=a,c.updateSelected()})}return __extends(b,a),b.prototype.updateSelected=function(){void 0!==this.selected&&this.sourceArea.text(this.sources[this.selected].source)},b.prototype.setSelected=function(a){if(0!==this.sources.length&&(a=(a+this.sources.length)%this.sources.length,a!==this.selected)){var b=this.sourceTabContainer.children();this.selected=a,b.removeClass("math-ui-selected"),l(b[a]).addClass("math-ui-selected"),this.updateSelected()}},b.prototype.show=function(){var b=this,d=function(){b.sourceArea.focus()[0].select()},f=[{label:"Select All",action:d},{label:"Close",action:function(){b.close()}}];this.sourceArea=l(c("textarea")).attr("readonly","readonly"),this.sourceTabContainer=l(c("div")).addClass("math-ui-types").attr("tabindex",0),m.each(this.sources,function(a){b.sourceTabContainer.append(l(c("span")).append(e(a)))}),a.prototype.show.call(this,"math-ui-dialog math-ui-source",function(a){a.append(l(c("div")).addClass("math-ui-header").append("Markup for "+b.host.name),l(c("div")).addClass("math-ui-content").append(b.sourceTabContainer,b.sourceArea))},f),this.setSelected(0),this.fitContentHeight(),this.sourceTabContainer.focus(),this.sourceArea.on("copy",function(a){console.log("copy",a),a.originalEvent.clipboardData.setData("text/plain","Simulated copy. Yay!"),a.originalEvent.clipboardData.setData("application/mathml+xml","<math><mi>x</mi></math>"),a.preventDefault()})},b.prototype.close=function(){this.sources=this.sourceTabContainer=this.sourceArea=void 0,a.prototype.close.call(this)},b.prototype.click=function(a){var b=this;this.sourceTabContainer.children().each(function(c,d){d===a.target&&b.setSelected(c)})},b.prototype.keydown=function(a){if(a.target===this.sourceTabContainer[0]){var b=m.indexOf([37,39],a.which);b>=0&&this.setSelected(this.selected+(0===b?1:-1))}},b}(s),v=function(){function b(a,b){var c=this;this.element=a;var d=l(a),e=d.data("type"),f=p.get(e)||p.find(function(b){return b.canHandle(a)});if(!f)throw"MathUI: No matching handler";this.id="math-ui-element-"+b,this.name="Equation "+(b+1),this.handler=f,d.attr("id",this.id).attr("tabindex",0).attr("role","math").on("focus",function(){c.gotFocus()})}return b.prototype.initHandler=function(){return this.handler.init(this.element)},b.prototype.clonePresentation=function(a){this.handler.clonePresentation(this.element,a[0])},b.prototype.getSources=function(){return this.handler.getSources(this.element)},b.prototype.changeHighlight=function(a){var b=l(this.element);a?b.addClass("highlight"):b.removeClass("highlight")},b.prototype.zoomAction=function(){var a=new t(this);a.show()},b.prototype.sourceAction=function(){var a=new u(this);a.show()},b.prototype.gotFocus=function(){var e,f=this,g=l(this.element),h=function(){g.blur(),a.async(function(){b.menuItems[e].action.call(f)})},i=l(m.map(b.menuItems,function(){return c("span")})).addClass("math-ui-item"),j=l(c("div")).addClass("math-ui-eqn-menu").append(l(c("span")).addClass("math-ui-header").append(this.name),l(c("span")).addClass("math-ui-container").append(i)),k=function(a){e=a,i.removeClass("math-ui-selected"),l(i[a]).addClass("math-ui-selected")},n=function(a){switch(a.which){case 13:a.preventDefault(),h();break;case 27:g.blur();break;case 37:k((e+b.menuItems.length-1)%b.menuItems.length);break;case 39:k((e+1)%b.menuItems.length)}},o=function(){j.remove(),g.off("keydown",n).off("blur",o)};i.each(function(a,c){l(c).append(b.menuItems[a].label).on("mousedown",function(b){1===b.which&&(d(b),k(a),h())})}),g.append(j).on("keydown",n).on("blur",o),k(0),j.css("top",g[0].offsetHeight-3+"px")},b.menuItems=[{label:"Zoom",action:b.prototype.zoomAction},{label:"View Markup",action:b.prototype.sourceAction},{label:"Dashboard",action:h}],b}(),w=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.show=function(){var d=this;a.prototype.show.call(this,"math-ui-dialog math-ui-dashboard",function(a){d.buttons=l(m.map(b.dashboardItems,function(){return c("button")})).each(function(a,c){l(c).append(b.dashboardItems[a].label)}),a.append(l(c("div")).addClass("math-ui-header").append("MathUI Dashboard"),l(c("div")).addClass("math-ui-content").append(d.buttons))}),this.buttons.first().focus(),this.fitContentHeight()},b.prototype.click=function(a){var c=m.indexOf(this.buttons.toArray(),a.target);if(c>=0&&c<b.dashboardItems.length){var d=b.dashboardItems[c];this.close(),d.action(d.label)}},b.dashboardItems=[{label:"Highlight All Equations",action:f},{label:"About MathUI",action:function(){g()}}],b}(s);a.prettifyMathML=function(){function a(a,b,c){var d=a.nodeName.toLowerCase(),e="<"+d+m.map(a.attributes,function(a){return" "+a.name+'="'+a.value+'"'}).join("");return c&&(e=c+e),b?e+">"+b+"</"+d+">":e+" />"}function b(a){return m.map(l(a).contents(),function(a){return c(a)}).join("")}function c(c){switch(c.nodeType){case 1:return a(c,b(c));case 3:return c.nodeValue;case 8:return"<!--"+c.nodeValue+"-->"}return""}function d(c,f){if(1!==c.nodeType)throw new Error("prettifyMathML: expected Element node");var g=c.nodeName.toLowerCase(),h="";if(m.contains(e,g))h=m.words(b(c)).join(" ");else{var i=m.map(l(c).children(),function(a){return d(a,f+"  ")});i&&(h="\n"+i.join("\n")+"\n"+f)}return a(c,h,f)}var e=["mi","mn","mo","ms","mtext","ci","cn","cs","csymbol","annotation"];return function(a){return d(a,"")}}(),a.showDashboard=h,a.registerHandler=i;var x=a.makePromiseWithResolver(),y=a.makePromiseWithResolver();a.initDone=j,a.renderingDone=k,a.microJQ.ready().then(function(){var b=[];"jQuery"in window&&jQuery.fn.on&&(l=jQuery),l(document).find(".math-ui").each(function(a,c){var d=new v(c,a),e=d.initHandler();q[d.id]=d,e&&b.push(e)}),x.resolve(),a.Promise.all(b).then(function(){y.resolve()})})}(MathUI||(MathUI={}));var MathUI;!function(a){"use strict";var b=a.get$(),c=(a.getUtils(),function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.canHandle=function(){return!0},c.prototype.getSources=function(b){return a.Promise.resolve([{type:"HTML",source:b.innerHTML}])},c}(a.Handler)),d=function(c){function d(){c.apply(this,arguments)}return __extends(d,c),d.getMathRoot=function(a){var c=b(a).children();if(1===c.length&&"math"===c[0].nodeName.toLowerCase())return c[0];if(c.length&&c[0]instanceof HTMLUnknownElement){var d=b.parseXML(a.innerHTML);if(d.documentElement&&"math"===d.documentElement.nodeName.toLowerCase())return d.documentElement}return null},d.prototype.canHandle=function(a){return null!==d.getMathRoot(a)},d.prototype.getSources=function(b){var c=d.getMathRoot(b);return a.Promise.resolve(null===c?[]:[{type:"MathML",subtype:"original",source:b.innerHTML},{type:"MathML",subtype:"prettified",source:a.prettifyMathML(c)}])},d}(a.Handler);a.registerHandler("plain-html",new c),a.registerHandler("native-mathml",new d)}(MathUI||(MathUI={}));var MathUI;!function(a){"use strict";var b=a.get$(),c=function(c){function d(a,b){c.call(this),this.original=a,this.internal=b}return __extends(d,c),d.prototype.init=function(b){var c,d=new a.Promise(function(a){c=a});return MathJax.Hub.Queue(["Typeset",MathJax.Hub,b],c),d},d.prototype.clonePresentation=function(a,c){var d=b(a).find("script[type]");b(c).append(d.clone().removeAttr("id").removeAttr("MathJax")),MathJax.Hub.Queue(["Typeset",MathJax.Hub,c])},d.prototype.getSources=function(b){var c=[],d=MathJax.Hub.getAllJax(b);if(d&&1===d.length){var e=d[0];if(c.push({type:this.original[0],subtype:this.original[1],source:e.originalText}),e.root.toMathML)return c.push({type:this.internal[0],subtype:this.internal[1],source:""}),new a.Promise(function(a){function b(){try{c[1].source=e.root.toMathML(""),a(c)}catch(d){if(!d.restart)throw d;MathJax.Callback.After(b,d.restart)}}b()})}return a.Promise.resolve(c)},d}(a.Handler);a.registerHandler("tex",new c(["TeX","original"],["MathML","MathJax"])),a.registerHandler("mml",new c(["MathML","original"],["MathML","MathJax"]))}(MathUI||(MathUI={}));var MathUI;!function(a){"use strict";var b=a.get$(),c=function(c){function d(){c.apply(this,arguments)}return __extends(d,c),d.prototype.clonePresentation=function(a,c){b(c).append(b(a).find("img").clone())},d.prototype.getSources=function(c){var d=[],e=b(c).find('script[type="math/mml"]');if(1===e.length){var f=e.text(),g=b.parseXML(f);d.push({type:"MathML",subtype:"original",source:f}),g&&g.documentElement&&"math"===g.documentElement.nodeName&&d.push({type:"MathML",subtype:"prettified",source:a.prettifyMathML(g.documentElement)})}return a.Promise.resolve(d)},d}(a.Handler);a.registerHandler("eqnstore",new c)}(MathUI||(MathUI={}));